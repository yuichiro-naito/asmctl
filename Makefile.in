prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
datarootdir = @datarootdir@
localstatedir = @localstatedir@
sysconfdir = @sysconfdir@
mandir = @mandir@
INSTALL = @INSTALL@
SED = @SED@
CC = @CC@
DEFS = -O @DEFS@
LIBS = @LIBS@
INCS = -I.

CONF = devd/asmctl.conf
MAN  = src/asmctl.1
SRCS = src/asmctl.c
OBJS = $(SRCS:.c=.o)
PROG = asmctl
VAR  = /var

all: $(PROG) $(CONF)

$(PROG): $(OBJS)
	$(CC) -o $@ $(OBJS) $(LIBS)

.c.o:
	$(CC) $(INCS) $(DEFS) -c -o $@ $<

$(CONF): $(CONF).s
	$(SED) -e "s|%%BINDIR%%|$(bindir)|" < $(CONF).s > $(CONF)

clean:
	rm -f $(OBJS) $(PROG) $(CONF)

install: $(PROG) $(CONF)
	$(INSTALL) -d $(VAR)/lib
	$(INSTALL) -d $(bindir)
	$(INSTALL) -m 4755 $(PROG) $(bindir)
	$(INSTALL) -d -m 755 $(sysconfdir)/devd
	$(INSTALL) -m 644 $(CONF) $(sysconfdir)/devd
	$(INSTALL) -d -m 755 $(mandir)/man1
	$(INSTALL) -m 444 $(MAN) $(mandir)/man1
