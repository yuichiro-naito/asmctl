prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
localstatedir = @localstatedir@
sysconfdir = @sysconfdir@
SED = @SED@
CC = @CC@
DEFS = -O @DEFS@
LIBS = @LIBS@
INCS = -I.

CONF = devd/asmctl.conf
SRCS = src/asmctl.c
OBJS = $(SRCS:.c=.o)
PROG = asmctl

all: $(PROG) devd/asmctl.conf

$(PROG): $(OBJS)
	$(CC) -o $@ $(OBJS) $(LIBS)

.c.o:
	$(CC) $(INCS) $(DEFS) -c -o $@ $<

$(CONF): $(CONF).s
	$(SED) -e "s|%%EXEC_PREFIX%%|$(bindir)|" < $(CONF).s > $(CONF)

clean:
	rm -f $(OBJS) $(PROG) devd/asmctl.conf

install: $(PROG) $(CONF)
	install -m 4755 $(PROG) $(bindir)
	mkdir -p $(sysconfdir)/devd
	install -m 644 $(CONF) $(sysconfdir)/devd
